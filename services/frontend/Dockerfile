FROM node:22-bookworm

WORKDIR /app

RUN npm install -g pnpm@10.11.0

COPY ./package.json ./

RUN pnpm install --lockfile-only

# Copy index.html to the WORKDIR root so Vite can find it by default.
COPY ./public/index.html ./index.html

# Copy the rest of the public assets to the 'public' directory in WORKDIR.
# Vite will automatically copy these to the root of the 'dist' directory during build.
COPY ./public/ ./public/

# This includes tsconfig.json, vite.config.ts, tailwind.config.ts, postcss.config.js, and the srcs/ directory.
# If pnpm-lock.yaml exists in the build context, it will overwrite the one generated by --lockfile-only.
COPY . .

# NOTE: --frozen-lockfile ensures that pnpm doesn't modify the lockfile and fails if inconsistencies are found.
RUN pnpm install --frozen-lockfile

RUN pnpm run build

# The build output will be in /app/dist
